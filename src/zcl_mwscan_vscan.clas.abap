CLASS zcl_mwscan_vscan DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_vscan_instance .
  PROTECTED SECTION.
  PRIVATE SECTION.

    METHODS get_http_client
      RETURNING
        VALUE(client) TYPE REF TO if_http_client .
ENDCLASS.



CLASS zcl_mwscan_vscan IMPLEMENTATION.


  METHOD get_http_client.
    cl_http_client=>create_by_destination(
      EXPORTING
        destination                = 'MWSCAN'
      IMPORTING
        client                     = client ).
  ENDMETHOD.


  METHOD if_vscan_instance~scan_bytes.
    DATA mwscan TYPE REF TO zcl_mwscan_client.
    DATA(client) = me->get_http_client( ).
    CREATE OBJECT mwscan
      EXPORTING
        ii_client = client.
    DATA(return_scan) = mwscan->zif_mwscan_interface~scans_a_file_for_malware_( data_to_scan = if_data ).
    IF return_scan-_200_app_json-malwaredetected = abap_true.
      ef_scanrc = if_vscan_instance=>con_scanrc_virus_found.
      APPEND INITIAL LINE TO et_infection ASSIGNING FIELD-SYMBOL(<infection>).
      <infection>-virus_name = return_scan-_200_app_json-finding.
    ELSE.
      ef_scanrc = if_vscan_instance=>con_scanrc_ok.
    ENDIF.
  ENDMETHOD.


  METHOD if_vscan_instance~scan_text.
    DATA mwscan TYPE REF TO zcl_mwscan_client.
    DATA(client) = me->get_http_client( ).
    CREATE OBJECT mwscan
      EXPORTING
        ii_client = client.
    DATA(return_scan) = mwscan->zif_mwscan_interface~scans_a_file_for_malware_( cdata_to_scan = if_text ).
    IF return_scan-_200_app_json-malwaredetected = abap_true.
      ef_scanrc = if_vscan_instance=>con_scanrc_virus_found.
      APPEND INITIAL LINE TO et_infection ASSIGNING FIELD-SYMBOL(<infection>).
      <infection>-virus_name = return_scan-_200_app_json-finding.
    ELSE.
      ef_scanrc = if_vscan_instance=>con_scanrc_ok.
    ENDIF.
  ENDMETHOD.
ENDCLASS.
